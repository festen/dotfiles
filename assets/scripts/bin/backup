#!/bin/zsh
SRC=$(realpath "$1")
test ! -d "$SRC" && echo "Could not resolve '$1'" && exit 1
CANONICAL=$(basename "$SRC")
test ! -n "$CANONICAL" && echo "Could not extract CANONICAL from '$SRC'" && exit 2
DEST=$(realpath "${2:-"$HOME/Documents/$CANONICAL"}")
test -d "$DEST" || mkdir -p "$DEST"

echo "Backing up from ${SRC} to ${DEST}."
echo "This will overwrite anything not existing in the later."

if test -t 0; then
  while true; do
      echo "continue [Y/n]?"
      read  yn
      case $yn in
          [YyEeSs]* ) make install; break;;
          [NnOo]* ) exit;;
          * ) echo "Please answer yes or no.";;
      esac
  done
fi

rsync\
  --acls\
  --archive\
  --delete\
  --delete-excluded\
  --exclude node_modules\
  --exclude .DS_Store\
  --exclude dist\
  --exclude build\
  --hard-links\
  --human-readable\
  --info progress2\
  --one-file-system\
  --progress\
  --sparse\
  --stats\
  --verbose\
  --whole-file\
  --xattrs\
  "$SRC/"\
  "$DEST/"\
  | tee "$DEST/backup.log"
